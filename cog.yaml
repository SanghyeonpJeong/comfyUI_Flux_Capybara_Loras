build:
  gpu: true
  cuda: "12.1"
  python_version: "3.11"
  python_packages:
    - "torch==2.1.2"
    - "diffusers==0.29.0"
    - "transformers==4.41.2"
    - "accelerate==0.30.1"
    - "huggingface-hub[cli]"

  run:
    # token을 /run/secrets/my_hf_secret에서 직접 읽음(런타임 시점)
    - "python -c \"from huggingface_hub import snapshot_download; import os; print('Attempting to download model by reading secret file...'); snapshot_download(repo_id='black-forest-labs/FLUX.1-dev', local_dir='/src/models', token=open('/run/secrets/my_hf_secret').read().strip(), cache_dir='/root/.cache/huggingface')\""

    - "mkdir -p /src/loras"
    - "curl -L -o /src/loras/Flux_Capybara_v1.safetensors https://github.com/SanghyeonpJeong/comfyUI_Flux_Capybara_Loras/raw/main/Flux_Capybara_v1.safetensors"

predict: "predict.py:Predictor"
