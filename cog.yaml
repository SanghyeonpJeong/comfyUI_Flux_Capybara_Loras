build:
  gpu: true
  cuda: "12.1"
  python_version: "3.11" 
  python_packages:
    - "torch==2.1.2"
    - "diffusers==0.29.0"
    - "transformers==4.41.2"
    - "accelerate==0.30.1"
    - "huggingface-hub[cli]" 

  run:
    # 1. Python이 /run/secrets/my_hf_secret 파일을 직접 열어서 토큰을 읽습니다.
    - "python -c \"from huggingface_hub import snapshot_download; print('Attempting to download model by reading secret file...'); snapshot_download(repo_id='black-forest-labs/FLUX.1-dev', local_dir='/src/models', token=open('/run/secrets/my_hf_secret').read().strip(), cache_dir='/root/.cache/huggingface')\""
    
    # 2. LoRA 파일 다운로드
    - "mkdir -p /src/loras"
    - "curl -L -o /src/loras/Flux_Capybara_v1.safetensors https://github.com/SanghyeonpJeong/comfyUI_Flux_Capybara_Loras/raw/main/Flux_Capybara_v1.safetensors"
    
    # Git이 변경 사항을 인식하도록 강제 주석 추가
    # Force update v20

predict: "predict.py:Predictor"